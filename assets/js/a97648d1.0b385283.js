"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[7119],{1028:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var o=t(4848),a=t(8453);const i={title:"2024-08-16 Daily Journal",slug:"20240816-daily-journal",authors:["umesh"],tags:["2024-08","2024","journal","daily"],hide_table_of_contents:!0},s=void 0,l={permalink:"/journal/20240816-daily-journal",source:"@site/../journal/20240816-daily-journal.md",title:"2024-08-16 Daily Journal",description:"Thinking about adding github actions to build and deploy this blog instead of running them on a VM on my machine. For some reason I couldn't get myself to install nodejs and npm on my regular workstation. Maybe I should do that as well.",date:"2024-08-16T10:18:29.000Z",tags:[{inline:!0,label:"2024-08",permalink:"/journal/tags/2024-08"},{inline:!0,label:"2024",permalink:"/journal/tags/2024"},{inline:!0,label:"journal",permalink:"/journal/tags/journal"},{inline:!0,label:"daily",permalink:"/journal/tags/daily"}],readingTime:1.82,hasTruncateMarker:!0,authors:[{name:"Poswal Umesh",title:"Maintainer of nakamorg",url:"https://github.com/nakamume",imageURL:"https://github.com/nakamume.png",key:"umesh"}],frontMatter:{title:"2024-08-16 Daily Journal",slug:"20240816-daily-journal",authors:["umesh"],tags:["2024-08","2024","journal","daily"],hide_table_of_contents:!0},unlisted:!1,prevItem:{title:"2024-08-15 Daily Journal",permalink:"/journal/20240815-daily-journal"}},r={authorsImageUrls:[void 0]},u=[];function d(n){const e={code:"code",p:"p",pre:"pre",...(0,a.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.p,{children:"Thinking about adding github actions to build and deploy this blog instead of running them on a VM on my machine. For some reason I couldn't get myself to install nodejs and npm on my regular workstation. Maybe I should do that as well."}),"\n",(0,o.jsx)(e.p,{children:"But for the time being I'm going to try my luck with github actions. Just added a github workflow file and pushing this blog file to master should trigger that. So, let get triggering!"}),"\n",(0,o.jsxs)(e.p,{children:["So, that worked. But only halfway. The last step ",(0,o.jsx)(e.code,{children:"npm run deploy"})," failed asking for my github username or specifying using ssh key. I was hoping that it would know how to push the changes as it was already running in github action. Let's see if ",(0,o.jsx)(e.code,{children:"Claude Opus"})," can help us figure this out. After multiple back and forth it suggested to use this snippet"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:"- name: Deploy\n    run: |\n    npm run deploy\n    working-directory: docusaurus\n    env:\n    GIT_USER: github-actions\n    GIT_PASS: ${{ secrets.GITHUB_TOKEN }}\n"})}),"\n",(0,o.jsxs)(e.p,{children:["I think it should work. I'm just not confident about the ",(0,o.jsx)(e.code,{children:"GIT_USER"})," part. Should I use my github username there instead? Anyways, let's try pushing and see how it goes."]}),"\n",(0,o.jsx)(e.p,{children:"The action run was succesful but it still didn't deploy, complaining about setting git user email and stuff. So, let's try with"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-yaml",children:'- name: Deploy\n  run: |\n    git config --global user.email "${{ github.actor }}@users.noreply.github.com"\n    git config --global user.name "${{ github.actor }}"\n    npm run deploy\n  working-directory: docusaurus\n  env:\n    GIT_USER: ${{ github.actor }}\n    GIT_PASS: ${{ secrets.GITHUB_TOKEN }}\n'})}),"\n",(0,o.jsxs)(e.p,{children:['That was it. The blog is "on" now. All I have to do is write and push to master and github will take care of build, deploy and hosting. Good times. One more thing though, I\'m not sure if the caching for node modules is working. Initial runs of ',(0,o.jsx)(e.code,{children:"npm ci"})," took about 10 secs and the latest one with a cache hit took 6 secs - so maybe it's working? Maybe I can try doing ",(0,o.jsx)(e.code,{children:"ls node_modules"})," in the github action and see or maybe there are other better options? But let's do that some other time. It's almost 19:18 and I need to get off working and start my work out."]})]})}function h(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>l});var o=t(6540);const a={},i=o.createContext(a);function s(n){const e=o.useContext(i);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:s(n.components),o.createElement(i.Provider,{value:e},n.children)}}}]);